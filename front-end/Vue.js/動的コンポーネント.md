# 動的にコンポーネントを切り替える方法
```
<script setup>
import { shallowRef } from 'vue';
import CompA from './components/CompA.vue';
import CompB from './components/CompB.vue';
import CompC from './components/CompC.vue';

const currentComp = shallowRef(CompA)
</script>

<template>
  <h1>Dynamic components</h1>
  <button @click="currentComp = CompA">A</button>
  <button @click="currentComp = CompB">B</button>
  <button @click="currentComp = CompC">C</button>
  <component :is="currentComp" />
</template>
```
* shallowRefと必要なコンポーネントをインポート
* コンポーネントを切り替えて表示する部分にcomponentタグを記述
    * componentタグ内に`:is="表示するコンポーネント名"`を記述
<br>

## shallowRefの役割
* Refと同じく、値をリアクティブにする
* Refと違い、オブジェクトの中の値まではリアクティブにしない
    * オブジェクトの中をリアクティブにしない分レンダリングのパフォーマンスが高い
<br>

## 動的コンポーネントのライフサイクル
* コンポーネントを切り替えるごとにMountとUnmountを繰り返す
* 動的コンポーネントの中でリアクティブな値を変更した場合、コンポーネントを切り替えた際、変更内容が破棄される

<br><br>

# 動的コンポーネントの状態を保持する
```
  <KeepAlive>
    <component :is="currentComp" />
  </KeepAlive>
```
* 状態を保持したいコンポーネントをKeepAliveタグで囲う
* KeepAliveタグでは一つのタグしか囲えない
    * v-ifとv-elseを書いた場合は表示されるのが必ずどちらかのタグになるので2つのタグを記述することができる
<br>

## KeepAliveの属性
### include
```
<KeepAlive include="CompB, CompC">
  <component :is="currentComp" />
</KeepAlive>
```
* `include="コンポーネント名(拡張子除く)"`の形で記述
* 指定したコンポーネントのみ、状態を保持するようになる
* カンマ区切り、もしくは配列化してコンポーネント名を文字列にすることで複数指定もできる
<br>

### exclude
```
<KeepAlive exclude="CompA">
  <component :is="currentComp" />
</KeepAlive>
```
* 指定したコンポーネントだけ状態が保持されなくなる
* カンマ区切り、もしくは配列化してコンポーネント名を文字列にすることで複数指定もできる
<br>

### max
```
<KeepAlive max="2">
  <component :is="currentComp" />
</KeepAlive>
```
* `max="数値"`または`:max=数値`の形で記述
* 指定された数値分しかコンポーネントの状態を保持しなくなる
    * 表示された最新のコンポーネントからさかのぼって、指定した数値分のコンポーネントの状態を保持する
    * 2を指定した場合、3つ目のコンポーネントを表示したときに最初に表示されたコンポーネントの状態が破棄される
<br>

## KeepAliveのライフサイクルフック
KeepAliveで囲ったコンポーネントは、最初に表示された時にmountされた後、コンポーネントを切り替えた際にunmountされない。  
そのため、onUnmountedで非表示を検知することができない。
<br>

### onActivated
```
onActivated(() => {
  console.log('onActivated')
})
```
* KeepAliveで囲われたコンポーネントが表示されるたびに、検知する
<br>

### onDeactivated
```
onDeactivated(() => {
  console.log('onDeactivated')
})
```
* KeepAliveで囲われたコンポーネントが非表示になるたびに、検知する