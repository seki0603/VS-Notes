---
tags:
  - コマンドライン
---

# バージョン管理システムとは

管理の対象となるディレクトリ以下のファイルが「いつ」「誰が」「何を」変更したか  
を記録することで、状態を管理するシステム。  
過去のある時点の状態を復元したり、変更内容の差分を表示できるようになる。

<br><br>

# Git/GitHub の基礎

## 使用する用語

| 用語                   | 説明                                                           |
| ---------------------- | -------------------------------------------------------------- |
| コミット               | ローカルリポジトリにプログラムの更新状態を記録すること。       |
| アド                   | ステージングエリアにプログラムの更新内容を記録すること。       |
| プッシュ               | ローカルリポジトリの情報をリモートリポジトリに反映すること。   |
| リモートリポジトリ     | インターネット上のサーバに配置されているリポジトリのこと。     |
| ローカルリポジトリ     | 自分のパソコン内のリポジトリのこと。                           |
| ステージングエリア     | コミットする前の更新内容の一時的な保存場所のこと。             |
| ワーキングディレクトリ | Git の管理下に置かれた、現在作業中のディレクトリの状態のこと。 |

<br>

## 活用するコマンド

| コマンド     | 説明                                                               |
| ------------ | ------------------------------------------------------------------ |
| git commit   | 追加・変更したファイルをローカルリポジトリに記録するコマンド       |
| git add      | 作業ディレククトリからステージングエリアに反映させるためのコマンド |
| git push     | ローカルリポジトリの内容をリモートリポジトリに反映させるコマンド   |
| git init     | ローカルリポジトリを作成するためのコマンド                         |
| git clone    | リモートリポジトリからクローンするコマンド                         |
| git pull     | リモートリポジトリの情報を取得するコマンド                         |
| git fetch    | 更新の最新情報を取得するコマンド                                   |
| git merge    | ローカルからリモートにマージするコマンド                           |
| git status   | ローカルリポジトリの更新状況を確認する                             |
| git branch   | ローカルのブランチの一覧を表示する                                 |
| git checkout | ローカルリポジトリのブランチを切り替えるコマンド                   |

<br>

## リポジトリとは

「リポジトリ＝変更履歴を保存している場所」

| リポジトリの種類   | 説明                                         | 特徴                               |
| ------------------ | -------------------------------------------- | ---------------------------------- |
| ローカルリポジトリ | 自分のパソコン内に配置されたリポジトリ       | 他人に干渉されずに開発が進められる |
| リモートリポジトリ | ネットワーク上のサーバに配置されたリポジトリ | 複数人でプログラムを共有できる     |

<br>
ローカルリポジトリで作業した内容を共有するときは  
リモートリポジトリにアップロードして公開する  
<br>
リモートリポジトリを通して他人のプログラムの詳細を確認することも可能

## ローカルリポジトリの運用

### コミット

「コミット＝変更内容を記録する」  
コミットすると、前回コミットしたときの状態から現在までの差分を記録したデータが  
リポジトリに格納される。  
<br>

## ワーキングディレクトリ/ステージングアリア

`ワーキングディレクトリ＝＞ステージングエリア＝＞ローカルリポジトリ`

- ワーキングディレクトリ　＝＞　 Git で管理された実際に仕事するディレクトリ
- ステージングエリア　＝＞コミットするファイルを置く場所

コミットは一日に一度が良いとされている。  
ステージングエリアに一度登録することで、必要ないファイルを省いてから  
コミットすることができる。  
<br>

## リポジトリの共有

### プッシュ

ローカルリポジトリにコミットした内容をリモートリポジトリにアップロードする  
<br>

### プル

リモートリポジトリから変更内容を取得し、ローカルリポジトリを更新する。  
<br>

### クローン

既存のリモートリポジトリを複製して、自分のパソコンに複製された  
ローカルリポジトリを作成する。  
<br>

### フェッチ

リモートリポジトリの最新履歴を取得する  
※プルと違い、自動でマージ（統合）されない

<br><br>

# 新規リポジトリ作成

作成フロー

1. リモートリポジトリの作成
2. ローカルリポジトリの作成
3. ステージングエリアにアド
4. ローカルリポジトリにコミット
5. ローカルリポジトリとリモートリポジトリの紐づけ
6. リモートリポジトリにプッシュ

<br>

## リモートリポジトリ作成

GitHub にアクセスし、左サイドバーの「New」をクリック  
以下３点を確認し、作成。

- リポジトリ名（苗字、名前は非推奨）
- 公開(Public)・非公開(Private)を選択
- 初期設定（後ほど変更可能）

<br>

## ローカルリポジトリ作成

- ローカルリポジトリを作成するディレクトリを作成
- リモートリポジトリの初期画面からコマンドをコピー
- 作成したディレクトリでコマンド実行

コピーするコマンドは SSH の時の「...or create a new~」のコマンド  
<br>

## リポジトリを編集する

ワーキングディレクトリからステージングエリアに反映させる  
`$ git status`  
上記コマンドで、赤色で表記されるものが、ワーキングディレクトリにあるもの。  
<br>

ステージングアリアに反映  
`$ git add .`  
git status で確認すると、反映されたものが緑色の表記に変わっている。  
<br>

コミットする
`$ git commit -m "サンプルファイルの追加"`  
ここまでで、ローカルリポジトリに変更内容を記録できている。  
<br>

リモートリポジトリにプッシュして情報を送る。  
`$ git push origin main`  
基本的には main でのプッシュはしてはいけない。

<br><br>

# リモートリポジトリの変更

作成フロー

1. リポジトリをクローンする
2. リモートリポジトリの作成をする
3. リモートリポジトリの紐付け先を変更する
4. ローカルリポジトリの変更を新しいリモートリポジトリに反映させる

<br>

## リポジトリをクローンする

リモートリポジトリが公開されている GitHub のページから SSH キーのリンクを取得  
`$ git clone リンク`  
コマンドラインでクローンしたリポジトリを保存したいディレクトリに移動し、  
上記コマンドにコピーしたリンクをペーストして実行。  
<br>

## リモートリポジトリを作成

変更先のリモートリポジトリを作成  
<br>

## リモートリポジトリの紐付け先を変更

現状のリンクを確認
`$ git remote -v`

```
origin	git@github.com:coachtech-material/php.git (fetch)
origin	git@github.com:coachtech-material/php.git (push)
```

<br>

変更先として作成したリポジトリのリンクをコピー（SSH を選択）  
`$ git remote set-url 変更前のリンク 新しい紐付け先リンク`  
変更完了。変更できたかを確認する。  
`$ git remote -v`

```
origin	git@github.com:ユーザ名/リポジトリ名.git (fetch)
origin	git@github.com:ユーザ名/リポジトリ名.git (push)
```

<br>

## ローカルリポジトリの変更を新しいリモートリポジトリに反映

1. ステージングエリアに反映させる
2. コミットする
3. リモートリポジトリにプッシュする

<br><br>

# Git の運用フロー

## 最も簡単な運用フロー

1. プログラムコードを編集する
2. ステージングエリアに反映させる
3. コミットする
4. リモートリポジトリにプッシュする
   「main もしくは master への直接プッシュと呼ばれ、一般的には禁止とされている。

## ブランチを使った運用方法

| コマンド     | 説明                                                             |
| ------------ | ---------------------------------------------------------------- |
| git branch   | ブランチを操作するためのコマンド                                 |
| git checkout | ブランチを切り替えるためのコマンド                               |
| git push     | プッシュするためのコマンド                                       |
| git pull     | リモートリポジトリの変更をローカルリポジトリにマージするコマンド |
| git fetch    | リモートリポジトリの変更を取得するためのコマンド(マージはしない) |
| git commit   | コミットするためのコマンド                                       |
| git add      | ステージングエリアに上げるためのコマンド                         |
| git log      | コミットの履歴を見るためのコマンド                               |
| git status   | 現在の状況を確認するためのコマンド                               |

<br>

## ブランチとは

プログラムコードを分けて記録するためのもの  
「ブランチを切る」＝ブランチを作成する  
<br>

ブランチを活用するメリット

- main の開発環境に影響を与えず、システムバグなどのリスクを軽減できる
- 機能単位で分けることで開発の履歴が確認しやすくなる

<br>

## ブランチの種類

無限に作成できるが、一定のルールを使った方が運用がしやすい。
<br>

主要なブランチの概要
|ブランチの種類| 概要|ブランチの命名規則|
|------------|------|----------------|
|main ブランチ |本番リリース公開用のブランチ。リポジトリを作成する時にデフォルトで作成されるブランチ。| main|
|develop ブランチ |本番リリース公開前の検証用のブランチ。| develop|
|feature ブランチ |個々の機能の実装やバグの解決ごとに分けて、開発を行うブランチ。| feature/機能名やタスク名|

<br>

## featureの命名規則
機能名やタスク名で定義する
|ブランチ名|	説明|	補足|
|---------|------|----|
|feature/chat	|機能の名前をつけるパターン|	機能名 = チャット機能 = chat|
|feature/create-chat	|タスク名をつけるパターン	|タスク名 = チャット機能を作成する = create-chat|
<br>

## ブランチの運用
1. ブランチを作成する
2. ブランチを切り替える（チェックアウト）
3. ブランチをリモートにプッシュする
4. プルリクエストを送る
5. マージする

<br>

* マージ　＝＞プログラムとプログラムを統合させること
* プルリクエスト　＝＞「マージしてください」という要求  

<br>

## ブランチを作成する
`$ git branch ブランチ名`  

よく使うオプション
|コマンド|	説明|
|-------|------|
|git branch	|ブランチの一覧の確認（ローカルのみ）|
|git branch -a	|すべてのブランチの一覧の確認|
|git branch -d |ブランチ名	ブランチの削除|

現在使用しているブランチは緑色で、リモートのブランチは赤色で表示される。
<br>

## ブランチを切り替える
`$ git checkout ブランチ名`  
新規作成も同時にする場合  
`$ git checkout -b ブランチ名`  

<br>

## ブランチをリモートにプッシュする
`$ git push origin ブランチ名`  
直前のコミットに対して紐付ける場合  
`$ git push origin HEAD`  

<br>

## プルリクエストを送る
GitHubのリモートリポジトリが格納されているページを開く  
pull requests > New pull request > ブランチの選択 > Create pull request の順で操作。  
最後のページのコメントで概要をまとめておく。  
<br>

## マージする
GitHubのリモートリポジトリが格納されているページを開く  
Compare & pull request > View pull request > Merge pull request > Confirm merge の順で操作。  
紫色でMergedとなっていればマージ成功  
<br>
マージが成功するとdelete branchボタンが出てくる  
開発中のブランチだけ残してわかりやすくするために、  
featureブランチはマージ後に削除するのが一般的だが、  
個人や小規模であれば無理に消す必要はない。  
<br>

## リモートリポジトリの編集情報を取得する
`$ git fetch`  

<br>

## リモートリポジトリの変更を反映させる
`$ git pull origin ブランチ`  
現在使用しているブランチの上であればgit pullだけでよい  
mainブランチのみの更新であればmainにチェックアウトしてプルすると良い。  
```
$ git checkout main
$ git pull
```

<br><br>

