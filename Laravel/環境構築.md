# セットアップ

1. ディレクトリ作成
2. docker-compose.yml 記述
3. Nginx 設定
   - default.conf
4. PHP 設定
   - Dockerfile
   - php.ini
5. MySQL 設定
   - my.cnf
6. phpMyAdmin の設定
   - docker-compose.yml

## ビルド

`docker-compose up -d --build`  
<br>

## composer 確認

PHP コンテナ内  
`composer -v`  
バージョンが返ってきたら成功

<br><br>

# Laravel プロジェクト作成

PHP コンテナ内
`composer create-project "laravel/laravel=バージョン" ディレクトリ --prefer-dist`  
<br>

## Laravel ウェルカムページアクセス

http://localhost/  
<br>

※権限エラー対策  
`sudo chmod -R 777 src/*`

<br>

## 時間設定

config/app.php の 70 行目付近を修正  
`'timezone' => 'UTC'` 変更＝＞ `'timezone' => 'Asia/Tokyo'`  
PHP コンテナ内で確認  
`php artisan tinker`  
`echo Carbon\Carbon::now();`  
日本の現在時刻が返ってきたら成功

<br><br>

# GitHub にあげる（任意）

## リモートリポジトリ作成

GitHub ログイン ⇒「New」から新規リポジトリ作成
<br>

## ローカルで Git 初期化

`cd your-project-directory`  
`git init`  
<br>

## .gitignore の確認

| 除外対象                    | 理由                                                        |
| --------------------------- | ----------------------------------------------------------- |
| /node_modules               | 重い依存ファイル。package.json があれば再インストールできる |
| /vendor                     | PHP 依存も同様に再インストール可能（composer install）      |
| .env                        | 開発環境ごとに異なるため。機密情報（DB パスなど）も含む     |
| /storage/\*.key             | SSL キーなど機密ファイルの可能性あり                        |
| /public/storage             | storage:link コマンドでシンボリックリンクを張る場所         |
| .idea, .vscode              | 開発者のエディタ設定。チームで共有すべきではない            |
| docker-compose.override.yml | 個人のローカル設定用のファイル                              |

<br>

.env が除外している場合、.env.example を作成しておく。  
`cp .env .env.example`  
デフォルトで作成されている場合もある  
<br>

## 初回コミット

```
git add .
git commit -m "Initial commit: Laravel環境構築完了"
```

※コメント内容は任意  
<br>

## GitHub と連携・プッシュ

GitHub で作成したリポジトリを選択し、「Code」から URL をコピー。  
`git remote add origin コピーしたURL`  
<br>

連携後、プッシュ。

```
git branch -M main
git push -u origin main
```

<br>

## README.md 作成

README にクローン手順（または共有手順）を記載

```
# 任意のディレクトリ名でクローン
`git clone クローン元のURL 新しいディレクトリ（クローン先）`

# ディレクトリに移動
`cd 新しいディレクトリ`

# Dockerコンテナ起動
`docker-compose up -d --build`

# Laravel依存パッケージをインストール
`docker-compose exec php bash`
`composer install`

# .envファイルを作成
PHPコンテナ上
`cp src/.env.example src/.env`

# アプリケーションキー生成
PHPコンテナ上
`php artisan key:generate`
```

<br><br>

# データベース接続

## データベース確認

Mysql コンテナ内  
`mysql -u laravel_user -p`  
※Laravel_user = docker-compose.yml の MYSQL_USER  
MY_PASSWORD で設定したパスワードでログインできれば成功  
<br>

データベース確認（MySQL 内）  
`show databases;`  
MYSQL_DATABASE で設定したデータベースが作成されていれば成功  
<br>

## データベース接続

.env ファイルを編集

```
  DB_CONNECTION=mysql
- DB_HOST=127.0.0.1
+ DB_HOST=mysql　　　　　※ホスト名を指定
  DB_PORT=3306
- DB_DATABASE=laravel
- DB_USERNAME=root
- DB_PASSWORD=
+ DB_DATABASE=laravel_db　　　　　※docker-compose.ymlの設定と連動させる
+ DB_USERNAME=laravel_user
+ DB_PASSWORD=laravel_pass
```

※保存時に権限エラーが出た場合  
`sudo chown -R ユーザー:ユーザー パス(基本カレント)`

接続したデータベースの確認  
phpMyAdmin  
http://localhost:8080/

<br><br>
